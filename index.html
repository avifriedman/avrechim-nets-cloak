<!doctype html>
<html lang="he">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>שעון דיגיטלי לנץ</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b1220;
    --accent:#00ffcc;
    --muted:#9fb4c4;
    --digital-font: 'Orbitron', sans-serif;
  }
  body{
    margin:0;
    min-height:100vh; /* Make sure body takes full viewport height */
    display:flex;
    flex-direction: column; /* Allow vertical stacking of content */
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg,#031026 0%, #071629 100%);
    color:var(--accent);
    font-family:var(--digital-font);
    direction:rtl; /* Ensure RTL for Hebrew */
    text-align: center; /* Center text within the body */
    overflow: hidden; /* Prevent scrollbars if content slightly overflows */
  }

  /* --- Styles for elements displaying time/numbers to ensure fixed width digits --- */
  .fixed-width-digits {
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum";
  }

  /* --- Default Clock Display Styles --- */
  #defaultDisplay {
    display: flex; /* Initially set to flex for centering */
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%; /* Fill available space */
  }

  #mainDisplay {
    font-size: 15vw; /* Large, responsive font size for main clock */
    letter-spacing: 0.05em; /* Slightly spaced letters for digital feel */
    line-height: 1; /* Tight line height */
    color: var(--accent);
    text-shadow: 0 0 15px rgba(0, 255, 204, 0.5); /* Subtle glow */
  }

  #subDisplay {
    font-size: 3vw; /* Smaller, responsive font size for sub-info */
    color: var(--muted);
    margin-top: 2vh; /* Relative margin from main clock */
  }

  /* --- Countdown Display Styles --- */
  #countdownArea {
    display: none; /* Hidden by default */
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    color: #fff; /* Brighter white for countdown text */
  }

  #countdown {
    font-size: 15vw; /* Same large size for countdown text */
    letter-spacing: 0.05em;
    line-height: 1;
    background: rgba(0,255,204,0.08); /* Slight background for contrast */
    padding: 0.5em 1em; /* Adjust padding for better look */
    border-radius: 12px;
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.7); /* Brighter glow for countdown */
  }

  .countdown-info {
    margin-top: 3vh; /* Relative margin from countdown */
    font-size: 3vw;
    color: var(--muted);
    line-height: 1.5; /* Spacing for info lines */
  }
  .countdown-info div {
    margin: 0.5vh 0; /* Small vertical margin between info lines */
  }

  /* --- Responsive Adjustments for Smaller Screens --- */
  @media(max-width:768px){
    #mainDisplay, #countdown {
      font-size: 20vw; /* Larger font on smaller screens relative to viewport */
    }
    #subDisplay, .countdown-info {
      font-size: 4.5vw;
    }
  }
  @media(max-width:480px){
    #mainDisplay, #countdown {
      font-size: 25vw;
    }
    #subDisplay, .countdown-info {
      font-size: 5.5vw;
    }
  }
</style>
</head>
<body>
  <!-- Container for the default clock display -->
  <div id="defaultDisplay">
    <div id="mainDisplay" class="fixed-width-digits">--:--:--</div>
    <div id="subDisplay">--</div>
  </div>

  <!-- Container for the countdown display (initially hidden) -->
  <div id="countdownArea">
    <div id="countdown" class="fixed-width-digits">00:00:00</div>
    <div class="countdown-info">
      <div>שעה נוכחית: <span id="nowSmall" class="fixed-width-digits">--:--:--</span></div>
      <div>שעת נץ: <span id="sunriseSmall" class="fixed-width-digits">--:--</span></div>
    </div>
  </div>

<script>
const CSV_PATH = './sunrise_times.csv';
const DEFAULT_SUNRISE = '06:00:00';
let sunriseMap = new Map(); // 'YYYY-MM-DD' -> { sunrise:'HH:MM:SS', hebrew:'...' }

function z(n,len=2){return String(n).padStart(len,'0');}

async function loadCsv(){
  try{
    const res = await fetch(CSV_PATH);
    if(!res.ok) throw new Error('CSV fetch error: ' + res.statusText);
    const txt = await res.text();
    parseCsv(txt);
  }catch(e){console.warn("בעיה בטעינת CSV",e);}
}

function parseCsv(text){
  const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l.length);
  if(lines.length === 0) return;
  let start = 0;
  if (/date/i.test(lines[0])) start = 1; // Skip header row if "date" is present

  for(let i=start;i<lines.length;i++){
    const cols = lines[i].split(',').map(c=>c.trim());
    if(cols.length < 3) continue; // Ensure there are enough columns

    const date = cols[0];       // YYYY-MM-DD (Gregorian date)
    const hebrew = cols[1];     // Hebrew date string
    let sunrise = cols[2];      // HH:MM[:SS]

    if(/^\d{2}:\d{2}$/.test(sunrise)) sunrise += ':00'; // Add seconds if only HH:MM

    if(/^\d{4}-\d{2}-\d{2}$/.test(date)){ // Validate date format
      sunriseMap.set(date,{sunrise,hebrew});
    }
  }
}

function getDataForDate(dateObj){
  const key = dateObj.toISOString().slice(0,10); // Format date to YYYY-MM-DD
  return sunriseMap.get(key) || {sunrise:DEFAULT_SUNRISE, hebrew:'—'};
}

function formatTime(d){
  return z(d.getHours())+":"+z(d.getMinutes())+":"+z(d.getSeconds());
}

function updateTick(){
  const now = new Date();
  // Create a date object for the current day at midnight, for consistent comparisons
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

  const data = getDataForDate(today);
  const hebrewDate = data.hebrew;
  const [sh,sm,ss] = data.sunrise.split(':').map(n=>parseInt(n,10));

  // Create a Date object for today's sunrise time
  const sunrise = new Date(today.getFullYear(), today.getMonth(), today.getDate(), sh, sm, ss||0);

  // Calculate the start time for the countdown (1 hour before sunrise)
  const switchStart = new Date(sunrise.getTime() - 3600000); // 3600000 ms = 1 hour

  // Get references to the display containers
  const defaultDisplay = document.getElementById('defaultDisplay');
  const countdownArea = document.getElementById('countdownArea');
  const mainDisplay = document.getElementById('mainDisplay');
  const subDisplay = document.getElementById('subDisplay');

  // Format weekday for sub-display
  const wd = new Intl.DateTimeFormat('he-IL',{weekday:'long'}).format(now);

  // --- Logic for display mode ---
  if(now >= switchStart && now < sunrise){
    // Countdown mode: Show countdownArea, hide defaultDisplay
    defaultDisplay.style.display = 'none';
    countdownArea.style.display = 'flex'; // Use flex for proper centering

    const diff = Math.max(0, Math.floor((sunrise - now) / 1000)); // Time difference in seconds
    const hh = Math.floor(diff / 3600);
    const mm = Math.floor((diff % 3600) / 60);
    const ss2 = diff % 60;

    document.getElementById('countdown').textContent = z(hh)+":"+z(mm)+":"+z(ss2);
    document.getElementById('nowSmall').textContent = formatTime(now);
    document.getElementById('sunriseSmall').textContent = z(sh)+":"+z(sm);

  } else {
    // Default clock mode: Show defaultDisplay, hide countdownArea
    defaultDisplay.style.display = 'flex'; // Use flex for proper centering
    countdownArea.style.display = 'none';

    mainDisplay.textContent = formatTime(now);
    subDisplay.textContent = wd + " • " + hebrewDate;
  }
}

// Initialize the clock: load CSV, then start updating every second
(async function init(){
  await loadCsv();
  updateTick(); // Initial update
  setInterval(updateTick,1000); // Update every second
})();
</script>
</body>
</html>
