<!doctype html>
<html lang="he">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>שעון נץ</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b1220;
    --accent:#00ffcc;
    --muted:#9fb4c4;
    --digital-font:'Orbitron',sans-serif;
  }
  body{
    margin:0;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg,#031026 0%, #071629 100%);
    color:var(--accent);
    font-family:var(--digital-font);
    direction:rtl;
  }
  .container{
    text-align:center;
    width:100%;
    height:100%;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
  }
  .bigclock{
    font-size:15vw;
    letter-spacing:6px;
    line-height:1;
  }
  .small{
    font-size:3vw;
    color:var(--muted);
    margin-top:1vh;
  }
  .countdown{
    margin-top:2vh;
    font-size:6vw;
    color:#fff;
    background:rgba(0,255,204,0.08);
    padding:1vh 2vw;
    border-radius:12px;
    display:inline-block;
  }
  .row{
    margin-top:2vh;
    font-size:3vw;
  }
</style>
</head>
<body>
  <div class="container">
    <div class="bigclock" id="mainClock">--:--:--</div>
    <div class="small" id="weekdayHeb">--</div>

    <div id="countdownArea" style="display:none;">
      <div class="countdown" id="countdown">00:00:00</div>
      <div class="small" style="margin-top:1vh;">
        נץ: <span id="sunriseSmall">--:--</span> | עכשיו: <span id="nowSmall">--:--:--</span>
      </div>
    </div>

    <div class="row" id="hebrewDate">--</div>
    <div class="row" id="gregDate">--</div>
  </div>

<script>
const CSV_PATH='./sunrise_times.csv';
const DEFAULT_SUNRISE='06:00:00';
let sunriseMap=new Map();

function z(n,len=2){return String(n).padStart(len,'0');}

async function loadCsv(){
  try{
    const res=await fetch(CSV_PATH);
    if(!res.ok) throw new Error('CSV fetch error');
    const txt=await res.text();
    parseCsv(txt);
  }catch(e){console.warn("בעיה בטעינת CSV",e);}
}

function parseCsv(text){
  const lines=text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length);
  if(lines.length===0) return;
  let start=0;
  if(/date/i.test(lines[0])) start=1;
  for(let i=start;i<lines.length;i++){
    const cols=lines[i].split(',').map(c=>c.trim());
    if(cols.length<3) continue;
    const date=cols[0],hebrew=cols[1],sunrise=cols[2];
    if(/^\d{4}-\d{2}-\d{2}$/.test(date)){
      let sr=sunrise;
      if(/^\d{2}:\d{2}$/.test(sr)) sr+=':00';
      sunriseMap.set(date,{sunrise:sr,hebrew});
    }
  }
}

function getDataForDate(d){
  const key=d.toISOString().slice(0,10);
  return sunriseMap.get(key)||{sunrise:DEFAULT_SUNRISE,hebrew:'—'};
}

function formatTime(d){return z(d.getHours())+":"+z(d.getMinutes())+":"+z(d.getSeconds());}

function updateTick(){
  const now=new Date();
  const today=new Date(now.getFullYear(),now.getMonth(),now.getDate());
  const data=getDataForDate(today);
  const [sh,sm,ss]=data.sunrise.split(':').map(n=>parseInt(n,10));
  const sunrise=new Date(today.getFullYear(),today.getMonth(),today.getDate(),sh,sm,ss||0);
  const switchStart=new Date(sunrise.getTime()-3600000);

  document.getElementById('mainClock').textContent=formatTime(now);
  document.getElementById('nowSmall').textContent=formatTime(now);
  document.getElementById('sunriseSmall').textContent=z(sh)+":"+z(sm);

  if(now>=switchStart && now<sunrise){
    document.getElementById('countdownArea').style.display='block';
    const diff=Math.max(0,Math.floor((sunrise-now)/1000));
    const hh=Math.floor(diff/3600), mm=Math.floor((diff%3600)/60), ss2=diff%60;
    document.getElementById('countdown').textContent=z(hh)+":"+z(mm)+":"+z(ss2);
  }else{
    document.getElementById('countdownArea').style.display='none';
  }

  const d=z(now.getDate()), m=z(now.getMonth()+1), y=now.getFullYear();
  document.getElementById('gregDate').textContent=`${d}/${m}/${y}`;
  const wd=new Intl.DateTimeFormat('he-IL',{weekday:'long'}).format(now);
  document.getElementById('weekdayHeb').textContent=wd+" • "+formatTime(now);
  document.getElementById('hebrewDate').textContent=data.hebrew;
}

(async function init(){
  await loadCsv();
  updateTick();
  setInterval(updateTick,1000);
})();
</script>
</body>
</html>
